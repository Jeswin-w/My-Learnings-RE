# Singleton

A singleton is a class which is stateless like a function. Its object is created only once.

There are many ways to create a singleton

1. Using a public instance variable

```java
 // Singleton with public final field
 public class Elvis {
    public static final Elvis INSTANCE = new Elvis();
    private Elvis() { ... }
    public void leaveTheBuilding() { ... }
 }
 ```
Nothing that a client does can change this,
with one caveat: a privileged client can invoke the private constructor reflectively
with the aid of the AccessibleObject.setAccessible method. If you need to defend against this attack, modify the constructor to make it throw an exception if itâ€™s asked to create a second instance.

2. Public static method
In the second approach to implementing singletons, the public member is a static factory method:
```java
 // Singleton with static factory
 public class Elvis {
    private static final Elvis INSTANCE = new Elvis();
    private Elvis() { ... }
    public static Elvis getInstance() { return INSTANCE;}
    public void leaveTheBuilding() { ... }
 }
```
One advantage of the static factory approach is that it gives you the flexibility to change your mind about whether the class is a singleton without changing its API. The factory method returns the sole instance, but it could be modified to
return, say, a separate instance for each thread that invokes it

A final advantage of using a static factory is that a method reference can be used as a supplier, for example Elvis::instance is a Supplier<Elvis>.
Unless one of these advantages is relevant, the public field approach is preferable.

This methods have other patterns like doble check singleton. Subclass initialization for thread safety.

The best way is to use a enum with a single object.

## Singleton on serializable class

To maintain the singleton guarantee, declare all instance fields transient and provide a readResolve method. Otherwise, each time a serialized instance is deserialized, a new instance will be created.

```java
 // readResolve method to preserve singleton property
 private Object readResolve() {
    // Return the one true Elvis and let the garbage collector
    // take care of the Elvis impersonator.
    return INSTANCE;
 }
 ```

## The best way to create a singleton class
```java
 public enum Elvis {
    INSTANCE;
    public void leaveTheBuilding() { ... }
 }
 ```

This approach is similar to the public field approach, but it is more concise,provides the serialization machinery for free, and provides an ironclad guarantee against multiple instantiation, even in the face of sophisticated serialization or reflection attacks.